import time
import getproxy
import json,requests,urllib.request
from traceback import print_exc
from ast import literal_eval
import pprint

def push_to_git():
    #Import dependencies
    from subprocess import call
    #Commit Message
    commit_message = "Updating json files"
    #Stage the file
    call('git add .', shell = True)
    # Add your commit
    call('git commit -m "'+ commit_message +'"', shell = True)
    #Push the new or update files
    call('git push origin master', shell = True)

def get_proxy():
    proxies=[]
    proxy= [ "117.254.218.69:8080", "59.91.122.1:54086", "103.94.66.85:46103", "103.89.253.249:3128", "220.227.0.209:3128", "103.79.228.235:39056", "116.203.97.244:443", "103.44.139.121:8080", "103.241.227.105:45087", "117.242.147.85:35891", "103.76.190.178:47115", "103.70.145.43:8080", "210.16.84.114:83", "219.65.66.130:80", "125.16.131.25:8080", "117.212.94.12:8080", "114.30.75.206:61101", "117.196.228.241:8080", "116.203.97.244:8000", "116.203.98.142:8000", "103.29.221.209:53914", "117.242.147.85:35891", "117.212.94.12:8080", "103.93.209.154:8080", "103.74.220.47:44073", "59.91.122.1:54086", "45.127.121.194:53281", "202.91.82.115:50307", "103.89.253.249:3128", "103.94.66.85:46103", "103.89.253.247:3128", "103.252.184.25:53281", "116.203.97.244:443", "103.251.222.132:8080", "117.254.210.226:8080", "150.242.255.206:8080", "43.225.192.85:8080", "116.203.97.244:8000", "210.16.84.114:83", "117.242.147.85:35891", "220.227.0.209:3128", "45.127.121.194:53281", "202.91.82.115:50307", "116.203.98.142:8000", "103.251.222.132:8080", "43.225.192.85:8080", "116.203.97.244:443", "114.30.75.206:61101", "150.242.255.206:8080", "117.212.94.12:8080", "103.74.220.47:44073", "103.89.253.249:3128", "117.239.218.227:3128", "103.44.139.121:8080", "49.128.170.110:55477", "103.93.209.154:8080", "125.23.34.123:3128", "117.212.94.12:8080", "117.241.96.40:39596", "103.70.145.43:8080", "49.128.170.110:55477", "219.65.66.130:80", "150.242.255.206:8080", "116.203.97.244:8000", "103.65.193.17:50862", "103.253.211.250:56884", "203.145.179.170:58892", "116.203.97.244:443", "103.89.253.249:3128", "103.74.220.47:44073", "202.91.82.115:50307", "125.23.34.123:3128", "117.196.228.241:8080", "103.93.209.154:8080", "103.89.253.247:3128", "117.254.210.226:8080", "103.29.221.209:53914", "103.89.253.249:3128", "117.196.228.241:8080", "114.30.75.206:61101", "103.89.253.247:3128", "117.242.147.93:49241", "220.227.0.209:3128", "103.78.181.139:8080", "117.212.94.12:8080", "45.127.121.194:53281", "103.251.222.132:8080", "117.241.96.40:39596", "103.239.232.186:30857", "116.203.97.244:8000", "103.29.221.209:53914", "103.44.139.121:8080", "103.43.40.20:53286", "219.65.66.130:80", "103.253.211.250:56884", "59.91.122.1:54086", "103.70.145.43:8080", "103.241.227.105:45087", "103.239.232.186:30857", "125.23.34.123:3128", "103.89.253.247:3128", "103.74.220.47:44073", "219.65.66.130:80", "116.203.97.244:8000", "103.251.222.132:8080", "117.242.147.85:35891", "114.30.75.206:61101", "125.16.131.25:8080", "116.203.97.244:443", "117.196.228.241:8080", "117.241.96.40:39596", "203.145.179.170:58892", "103.76.190.178:47115", "59.91.122.1:54086", "117.254.218.69:8080", "103.94.66.85:46103", "45.127.121.194:53281", "150.242.255.206:8080", "103.251.222.132:8080", "43.225.192.85:8080", "45.127.121.194:53281", "103.43.40.20:53286", "117.254.210.226:8080", "117.196.228.241:8080", "103.78.181.139:8080", "117.242.147.93:49241", "59.144.160.17:443", "116.203.97.244:8000", "203.145.179.170:58892", "103.252.184.25:53281", "103.89.253.247:3128", "103.93.209.154:8080", "103.239.232.186:30857", "117.212.94.12:8080", "117.241.96.40:39596", "220.227.0.209:3128", "117.254.218.69:8080", "103.29.221.209:53914", "111.125.141.6:61960", "49.128.170.110:55477", "45.127.121.194:53281", "103.44.139.121:8080", "59.91.122.1:54086", "117.254.210.226:8080", "103.252.184.25:53281", "220.227.0.209:3128", "114.30.75.206:61101", "43.225.192.85:8080", "117.212.94.12:8080", "116.203.98.142:8000", "125.16.131.25:8080", "103.233.123.101:8080", "210.16.84.114:83", "203.145.179.170:58892", "103.43.40.20:53286", "103.89.253.247:3128", "103.89.253.249:3128", "103.89.253.249:3128", "45.127.121.194:53281", "59.91.122.1:54086", "103.29.221.209:53914", "103.65.193.17:50862", "43.225.192.85:8080", "117.241.96.40:39596", "117.242.147.93:49241", "103.89.253.247:3128", "117.212.94.12:8080", "103.43.40.20:53286", "114.30.75.206:61101", "117.196.228.241:8080", "220.227.0.209:3128", "117.254.218.69:8080", "117.239.218.227:3128", "103.74.220.47:44073", "116.203.98.142:8000", "103.233.123.101:8080", "219.65.66.130:80", "103.74.220.47:44073", "103.253.211.250:56884", "103.241.227.105:45087", "116.203.97.244:443", "103.44.139.121:8080", "45.127.121.194:53281", "117.242.147.85:35891", "49.128.170.110:55477", "103.94.66.85:46103", "103.93.209.154:8080", "103.76.190.178:47115", "111.125.141.6:61960", "103.70.145.43:8080", "103.89.253.249:3128", "117.241.96.40:39596", "117.254.210.226:8080", "103.251.222.132:8080", "103.89.253.247:3128", "117.239.218.227:3128", "116.203.98.142:8000", "103.251.222.132:8080", "103.44.139.121:8080", "125.23.34.123:3128", "117.254.210.226:8080", "103.29.221.209:53914", "116.203.97.244:443", "103.43.40.20:53286", "103.74.220.47:44073", "117.212.94.12:8080", "103.252.184.25:53281", "103.70.145.43:8080", "117.196.228.241:8080", "117.242.147.85:35891", "117.242.147.93:49241", "203.145.179.170:58892", "116.203.97.244:8000", "59.91.122.1:54086", "103.233.123.101:8080", "103.253.211.250:56884", "114.30.75.206:61101", "111.125.141.6:61960", "219.65.66.130:80", "103.43.40.20:53286", "117.196.228.241:8080", "103.70.145.43:8080", "117.242.147.93:49241", "103.89.253.249:3128", "150.242.255.206:8080", "103.74.220.47:44073", "117.254.210.226:8080", "103.44.139.121:8080", "117.239.218.227:3128", "103.89.253.247:3128", "103.233.123.101:8080", "116.203.97.244:8000", "103.29.221.209:53914", "114.30.75.206:61101", "59.91.122.1:54086", "203.145.179.170:58892", "103.253.211.250:56884", "117.254.210.226:8080", "125.16.131.25:8080", "220.227.0.209:3128", "103.94.66.85:46103", "183.87.14.250:44915", "43.225.23.49:8080", "103.82.99.65:59376", "103.224.185.10:44051", "14.102.50.28:52667", "103.69.220.11:3128", "103.216.95.16:61755", "103.218.102.22:8080", "103.225.30.1:53281", "103.216.95.16:61755", "103.72.216.194:38345", "103.226.3.233:8080", "103.54.28.26:61774", "103.72.216.194:38345", "123.176.43.218:40524", "163.53.87.22:8080", "14.102.50.28:52667", "14.102.67.101:30337", "103.225.30.1:53281", "103.88.221.114:31205", "43.241.28.55:8080", "103.112.9.12:58948", "103.224.185.10:44051", "123.176.43.218:40524", "27.116.51.115:8080", "150.242.255.247:8080", "14.102.67.101:30337", "103.54.28.26:61774", "103.226.3.233:8080", "103.205.112.1:23500", "103.105.40.145:16538", "27.116.51.115:8080", "27.116.20.209:36630", "150.242.255.247:8080", "103.105.40.145:16538", "103.102.73.71:8080", "43.227.131.129:83", "203.192.195.14:31062", "27.116.20.209:36630", "116.197.152.198:61568", "103.56.30.128:8080", "103.224.37.3:83", "202.138.127.66:80", "103.21.161.105:6666", "1.186.63.130:39142", "103.226.142.90:41386", "43.227.131.129:83", "103.224.37.3:83", "103.226.142.90:41386", "202.138.127.66:80", "103.39.251.241:8080", "103.56.30.128:8080", "103.51.26.233:30867", "183.87.153.98:49602", "103.98.79.42:46525", "14.102.44.136:60175", "103.98.79.42:46525", "183.87.153.98:49602", "150.242.255.58:8080", "14.142.145.156:80", "14.102.189.165:8080", "103.233.123.101:8080", "103.250.152.62:47650", "150.242.255.58:8080", "14.102.189.165:8080", "103.76.190.193:49939", "43.240.5.1:31777", "103.233.123.101:8080", "103.75.161.38:21776", "14.142.145.156:80", "125.62.214.201:56865", "103.47.218.77:46297", "103.76.190.193:49939", "103.199.157.133:40052", "103.75.161.38:21776", "117.211.166.214:3128", "103.69.220.13:8080", "14.102.44.136:60175", "103.15.60.21:8080", "139.5.26.27:53281", "103.69.220.13:8080", "103.47.218.77:46297", "103.25.47.130:8080", "45.112.57.230:61222", "103.25.47.130:8080", "43.240.5.1:31777", "103.46.233.15:83", "117.211.166.214:3128", "103.199.157.133:40052", "103.194.240.54:48989"]
    i,j=0,0

    for p in proxy:
        user_agent = {'User-agent': 'Mozilla/5.0'}
        url = 'http://pubproxy.com/api/proxy?country=IN&limit=20&https=True&user_agent=true'

        while(len(proxies)<5000):
            try:
                j=0
                resp = requests.get(url=url,headers=user_agent,proxies={"http": p, "https": p})
                data = resp.json()
                time.sleep(2.1)
                for proxy in data['data']:
                    proxies.append(proxy['ipPort'])
                print('Length of Proxy till '+str(i)+'th attempt is ',len(proxies))
            except Exception as e:
                print_exc()
                print('Skipped proxy '+str(p)+" "+str(i)+' time')
                break
            finally:
                i=i+1

    try:
        print("Entered Spy proxy")
        proxies=proxies+spy_proxy()
    except Exception :
        pass

    try:
        proxies=proxies+fate_proxy()
    except Exception:
        pass

    return proxies

def fate_proxy():
    resp=requests.get('https://raw.githubusercontent.com/fate0/proxylist/master/proxy.list')
    a=((resp.text).split('\n'))
    p_list=[]
    for i in a:
        try:
            p_list.append(json.loads(i))
        except Exception as e:
            continue
    np_list=[]
    for i in p_list:
        if i['country']=='IN':
            np_list.append(i)
    #print(len(np_list))
    proxy=[]
    for i in np_list:
        proxy.append((str(i['host'])+':'+str(i['port'])))
    return(proxy)

def spy_proxy():
    resp=requests.get('http://spys.me/proxy.txt')
    data=((resp.text).split("Google_passed(+)")[1]).split('\r')[0]
    data=data.split('\n')
    l=[]
    for i in data:
        if 'IN' in i:
            i=i.split(' IN')[0]
            l.append(i)
    return l


proxy_json={'data':get_proxy()}
import json
with open('proxy.json', 'w') as outfile:
    json.dump(proxy_json, outfile)
push_to_git()
